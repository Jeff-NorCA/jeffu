# Publish a release and attach a zip (for Kodi).
# Trigger: Manual (Actions → publish-release → Run workflow)
# Defaults supplied for tag v1.0.4 and the commit you provided.
name: Publish Release for Kodi

on:
  workflow_dispatch:
    inputs:
      tag:
        description: 'Release tag (e.g. v1.0.4)'
        required: true
        default: 'v1.0.4'
      commit:
        description: 'Commit SHA where the zip lives'
        required: true
        default: '072ef7f08937770a531201b9e24eb05d7ffc395e'
      filename:
        description: 'Zip filename (path relative to repo root)'
        required: true
        default: 'repository.zachmorris-1.0.4.zip'
      release_name:
        description: 'Release title'
        required: true
        default: 'zachmorris repository v1.0.4'
      release_notes:
        description: 'Release notes/body'
        required: false
        default: 'Initial repo release for Kodi add-on'
      draft:
        description: 'Create as draft? (true/false)'
        required: false
        default: 'false'

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: Download zip from commit
        env:
          COMMIT: ${{ github.event.inputs.commit }}
          FILENAME: ${{ github.event.inputs.filename }}
          REPO: ${{ github.repository }}
        run: |
          echo "Downloading $FILENAME from commit $COMMIT in $REPO"
          curl -fL -o "$FILENAME" "https://raw.githubusercontent.com/${REPO}/${COMMIT}/${FILENAME}"
          echo "Downloaded $(ls -lh $FILENAME || true)"

      - name: Create Release
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.event.inputs.tag }}
          release_name: ${{ github.event.inputs.release_name }}
          body: ${{ github.event.inputs.release_notes }}
          draft: ${{ github.event.inputs.draft }}
          prerelease: false

      - name: Upload Release Asset
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ steps.create_release.outputs.upload_url }}
          asset_path: ${{ github.event.inputs.filename }}
          asset_name: ${{ github.event.inputs.filename }}
          asset_content_type: application/zip
